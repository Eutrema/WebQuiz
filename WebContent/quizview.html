<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="dwr/engine.js"></script>
<script type="text/javascript" src="dwr/util.js"></script>
<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/jquery.serialize.js"></script>
<script type="text/javascript" src="dwr/interface/QuizGetter.js"></script>
<script type="text/javascript">
    //このページに必要なデータ : deadline, list{answerID, answerName, answer}
    //メソッド名候補 : getDeadLine, getAnswerList
    //リバースAjaxについて調べる
    //→この動作に向いてないっぽい？ので普通に秒指定で問い合わせる
    //こういうのを使うらしい→ dwr.engine.setActiveReverseAjax(true);
    var currentQuizID = 0;
	if (window.location.search) {
        currentQuizID = unescape(window.location.search.substring(1, window.location.search.length));
	}
    QuizGetter.getDeadline(currentQuizID, {
    	callback: function(data) {
    		$('#deadline').text(data);
    	}
    });
	function getGuestAnswersData() {
		QuizGetter.getGuestAnswersData(currentQuizID, {
			callback : function(data) {
				var text = "<table>";
				var answerNumber = data.length;//, ans0 = 0, ans1 = 0;
				for (var i = 0; i < data.length; ++i) {
					text += "<tr>";
					text += "<td>";
					text += "ID: ";
					text += data[i].guestID;
					text += "</td>";
					text += "<td>";
					text += "名前: ";
					text += data[i].guestName;
					text += "</td>";
					text += "<td>";
					text += "解答: ";
					text += data[i].answer;
					text += "</td>";
					text += "</tr>\n";
				}
				text += "\n</table>";
				if (text == "<table>\n</table>") {
					text += "<br />まだ解答者がいません。";
				} else {
					text += "<br /><br />只今の回答者: ";
					text += answerNumber;
					text += "人";
					//語群のフォーマットが固まれば、全体で何人が○を選択したか などが表示できるようになる
					/*
					text += "<br />○: ";
					text += ans1;
					text += "人,   ×: ";
					text += ans0;
					text += "人,   未回答: ";
					text += answerNumber - ans0 - ans1;
					*/
				}
				$('#area').html(text);
			}
		});
	}
	getGuestAnswersData();
	setInterval(getGuestAnswersData, 5000);
</script>
</head>
<body>
	クイズ期間 <span id="deadline"></span>まで
	<div id="area">
	</div>
	<br>
	<input value="クイズ一覧に戻る" type="button"
		onclick="window.location.href ='quizlist.html'" />
</body>
</html>